From b305c538037b3ea0c80dec75701cb20aa800e353 Mon Sep 17 00:00:00 2001
From: Marko Kenttala <marko.kenttala@jolla.com>
Date: Wed, 19 Feb 2020 10:41:03 +0200
Subject: [PATCH] Added required-group provider element

---
 libaccounts-glib/accounts-provider.dtd |  3 +++
 libaccounts-glib/ag-internals.h        |  1 +
 libaccounts-glib/ag-provider.c         | 22 ++++++++++++++++++++++
 libaccounts-glib/ag-provider.h         |  1 +
 4 files changed, 27 insertions(+)

diff --git a/libaccounts-glib/accounts-provider.dtd b/libaccounts-glib/accounts-provider.dtd
index cdd477c..a44872a 100644
--- a/libaccounts-glib/accounts-provider.dtd
+++ b/libaccounts-glib/accounts-provider.dtd
@@ -53,3 +53,6 @@
 <!ATTLIST setting
   name ID #REQUIRED
   type CDATA "s">
+
+<!-- Name of the user group required for this provider. -->
+<!ELEMENT required-group (#PCDATA)>
diff --git a/libaccounts-glib/ag-internals.h b/libaccounts-glib/ag-internals.h
index 046e3ae..4af76f4 100644
--- a/libaccounts-glib/ag-internals.h
+++ b/libaccounts-glib/ag-internals.h
@@ -178,6 +178,7 @@ struct _AgProvider {
     gchar *file_data;
     gboolean single_account;
     GHashTable *default_settings;
+    gchar *required_group;
 };
 
 G_GNUC_INTERNAL
diff --git a/libaccounts-glib/ag-provider.c b/libaccounts-glib/ag-provider.c
index 187614b..93d166c 100644
--- a/libaccounts-glib/ag-provider.c
+++ b/libaccounts-glib/ag-provider.c
@@ -142,6 +142,10 @@ parse_provider (xmlTextReaderPtr reader, AgProvider *provider)
             {
                 ok = parse_template (reader, provider);
             }
+            else if (strcmp (name, "required-group") == 0)
+            {
+                ok = _ag_xml_dup_element_data (reader, &provider->required_group);
+            }
             else
                 ok = TRUE;
 
@@ -424,6 +428,24 @@ ag_provider_get_plugin_name (AgProvider *provider)
     return provider->plugin_name;
 }
 
+/**
+ * ag_provider_get_required_group:
+ * @provider: the #AgProvider.
+ *
+ * Get the name of the user group required for this #AgProvider.
+ *
+ * Returns: the required user group name for @provider, or %NULL if it is not
+ * defined.
+ *
+ * Since: 1.5
+ */
+const gchar *
+ag_provider_get_required_group (AgProvider *provider)
+{
+    g_return_val_if_fail (provider != NULL, NULL);
+    return provider->required_group;
+}
+
 /**
  * ag_provider_get_single_account:
  * @provider: the #AgProvider.
diff --git a/libaccounts-glib/ag-provider.h b/libaccounts-glib/ag-provider.h
index 9772dc2..cfca7db 100644
--- a/libaccounts-glib/ag-provider.h
+++ b/libaccounts-glib/ag-provider.h
@@ -49,6 +49,7 @@ void ag_provider_get_file_contents (AgProvider *provider,
 AgProvider *ag_provider_ref (AgProvider *provider);
 void ag_provider_unref (AgProvider *provider);
 void ag_provider_list_free (GList *list);
+const gchar *ag_provider_get_required_group (AgProvider *provider);
 
 G_END_DECLS
 
-- 
2.17.1

